<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaderboard</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <link rel="stylesheet" href="../CSS/nav.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        background: linear-gradient(
            rgba(25, 25, 25, 0.85),
            rgba(25, 25, 25, 0.85)
          ),
          url("/IMG/login_signup_background.png");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        font-family: sans-serif;
      }

      main {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 90vh;
        padding: 2rem;
        box-sizing: border-box;
      }

      .leaderboard-box {
        background: #fff;
        padding: 2rem;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 600px;
      }

      .leaderboard-box h1 {
        text-align: center;
        font-size: 2rem;
        color: #2c3e50;
        margin-bottom: 1.5rem;
      }

      .player {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9f9f9;
        margin-bottom: 0.8rem;
        padding: 0.8rem 1rem;
        border-radius: 10px;
        transition: 0.2s;
      }

      .player:hover {
        background: #eef2f5;
      }

      .player-info {
        display: flex;
        flex-direction: column;
      }

      .player-info span:first-child {
        font-weight: bold;
        color: #333;
      }

      .player-stats {
        text-align: right;
        font-size: 0.95rem;
      }

      .rank {
        font-weight: bold;
        margin-right: 1rem;
        width: 30px;
        color: #777;
      }

      hr {
        border: 2px solid #d3d3d3;
        border-radius: 10px;
      }

      .pagination {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
      }

      .pagination button {
        padding: 8px 16px;
        font-size: 1rem;
        border-radius: 6px;
        border: none;
        background-color: #2c3e50;
        color: #fff;
        cursor: pointer;
        transition: background 0.2s;
      }

      .pagination button:hover {
        background-color: #1a242f;
      }

      .pagination button:disabled {
        background-color: #b0bec5;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="logo">
          <h1>LearnQuest</h1>
        </div>
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li id="quiz-tab" class="hidden">
            <a href="quiz.html">Quizzes</a>
          </li>
          <li id="achievement-tab" class="hidden">
            <a href="achivement.html">Achivement</a>
          </li>
          <li id="leaderboard-tab" class="hidden">
            <a href="leaderboard.html">Leaderboard</a>
          </li>
          <li>
            <button onclick="loginpage()" id="login-btn" class="login-btn">
              Login
            </button>
          </li>
          <li id="pro" onclick="toggleProfile()" class="profile">
            <span id="profile" class="material-symbols-outlined"
              >account_circle</span
            >
          </li>
        </ul>
        <div class="icon" id="burger">
          <span id="bar" class="material-symbols-outlined">menu</span>
        </div>
        <div class="sub-menu-wrap" id="submenu">
          <div class="sub-menu">
            <div><p id="log-email"></p></div>
            <hr />
            <div id="profile-logout" class="logout-area">
              <span class="material-symbols-outlined">logout</span>Logout
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div class="leaderboard-box">
        <h1>üèÜ Leaderboard</h1>
        <hr />
        <div id="leaderboard"></div>
        <hr />
        <div class="pagination">
          <button id="prevBtn" disabled>&lt;</button>
          <button id="nextBtn">&gt;</button>
        </div>
      </div>
    </main>

    <script type="module">
      import { db } from "../JavaScript/firbase-config.js";
      import {
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

      const leaderboardContainer = document.getElementById("leaderboard");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      let allPlayers = [];
      let currentPage = 1;
      const playersPerPage = 5;

      async function loadLeaderboard() {
        const querySnapshot = await getDocs(collection(db, "users"));

        querySnapshot.forEach((doc) => {
          const data = doc.data();
          allPlayers.push({
            email: data.email,
            points: data.points ?? 0,
            level: data.level ?? 1,
            trophy: data.trophy ?? 0,
          });
        });

        // Sort players by points descending
        allPlayers.sort((a, b) => b.points - a.points);

        // Render the current page
        renderPlayers();
      }

      function renderPlayers() {
        leaderboardContainer.innerHTML = "";

        // Get the slice of players for the current page
        const startIndex = (currentPage - 1) * playersPerPage;
        const playersToDisplay = allPlayers.slice(
          startIndex,
          startIndex + playersPerPage
        );

        playersToDisplay.forEach((player, index) => {
          leaderboardContainer.innerHTML += `
          <div class="player">
            <div class="rank">#${startIndex + index + 1}</div>
            <div class="player-info">
              <span>${player.email}</span>
              <small>Level ${player.level}</small>
            </div>
            <div class="player-stats">
              <div>Points: ${player.points}</div>
              <div>üèÜ ${player.trophy}</div>
            </div>
          </div>
        `;
        });

        // Update pagination buttons
        updatePagination();
      }

      function updatePagination() {
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage * playersPerPage >= allPlayers.length;
      }

      // Pagination button click
      prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderPlayers();
        }
      });

      nextBtn.addEventListener("click", () => {
        if (currentPage * playersPerPage < allPlayers.length) {
          currentPage++;
          renderPlayers();
        }
      });

      loadLeaderboard();
    </script>

    <script src="../JavaScript/dash2.js" type="module"></script>
    <script src="../JavaScript/dashboard.js"></script>
  </body>
</html>
